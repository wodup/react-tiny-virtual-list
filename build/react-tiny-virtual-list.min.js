!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["react","prop-types"],e):t.VirtualList=e(t.React,t.PropTypes)}(this,function(t,e){"use strict";function o(t,e){function o(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}function i(t,e){var o={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(o[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&(o[i[n]]=t[i[n]]);return o}var n,r,s,a,l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])},f=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++){e=arguments[o];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},d="observed",c="requested",u=(n={},n.vertical="scrollTop",n.horizontal="scrollLeft",n),h=(r={},r.vertical="height",r.horizontal="width",r),p=(s={},s.vertical="top",s.horizontal="left",s),m=(a={},a.vertical="translateY",a.horizontal="translateX",a),g=function(){function t(t){var e=t.itemCount,o=t.itemSizeGetter,i=t.estimatedItemSize;this.itemSizeGetter=o,this.itemCount=e,this.estimatedItemSize=i,this.itemSizeAndPositionData={},this.lastMeasuredIndex=-1}return t.prototype.updateConfig=function(t){var e=t.itemCount,o=t.estimatedItemSize;this.itemCount=e,this.estimatedItemSize=o},t.prototype.getLastMeasuredIndex=function(){return this.lastMeasuredIndex},t.prototype.getSizeAndPositionForIndex=function(t){if(t<0||t>=this.itemCount)throw Error("Requested index "+t+" is outside of range 0.."+this.itemCount);if(t>this.lastMeasuredIndex){for(var e=this.getSizeAndPositionOfLastMeasuredItem(),o=e.offset+e.size,i=this.lastMeasuredIndex+1;i<=t;i++){var n=this.itemSizeGetter(i);if(null==n||isNaN(n))throw Error("Invalid size returned for index "+i+" of value "+n);this.itemSizeAndPositionData[i]={offset:o,size:n},o+=n}this.lastMeasuredIndex=t}return this.itemSizeAndPositionData[t]},t.prototype.getSizeAndPositionOfLastMeasuredItem=function(){return this.lastMeasuredIndex>=0?this.itemSizeAndPositionData[this.lastMeasuredIndex]:{offset:0,size:0}},t.prototype.getTotalSize=function(){var t=this.getSizeAndPositionOfLastMeasuredItem();return t.offset+t.size+(this.itemCount-this.lastMeasuredIndex-1)*this.estimatedItemSize},t.prototype.getUpdatedOffsetForIndex=function(t){var e=t.align,o=void 0===e?"start":e,i=t.containerSize,n=t.currentOffset,r=t.targetIndex;if(i<=0)return 0;var s,a=this.getSizeAndPositionForIndex(r),l=a.offset,f=l-i+a.size;switch(o){case"end":s=f;break;case"center":s=l-(i-a.size)/2;break;case"start":s=l;break;default:s=Math.max(f,Math.min(l,n))}var d=this.getTotalSize();return Math.max(0,Math.min(d-i,s))},t.prototype.getVisibleRange=function(t){var e=t.containerSize,o=t.offset,i=t.overscanCount;if(0===this.getTotalSize())return{};var n=o+e,r=this.findNearestItem(o);if(void 0===r)throw Error("Invalid offset "+o+" specified");var s=this.getSizeAndPositionForIndex(r);o=s.offset+s.size;for(var a=r;o<n&&a<this.itemCount-1;)a++,o+=this.getSizeAndPositionForIndex(a).size;return i&&(r=Math.max(0,r-i),a=Math.min(a+i,this.itemCount-1)),{start:r,stop:a}},t.prototype.resetItem=function(t){this.lastMeasuredIndex=Math.min(this.lastMeasuredIndex,t-1)},t.prototype.findNearestItem=function(t){if(isNaN(t))throw Error("Invalid offset "+t+" specified");t=Math.max(0,t);var e=this.getSizeAndPositionOfLastMeasuredItem(),o=Math.max(0,this.lastMeasuredIndex);return e.offset>=t?this.binarySearch({high:o,low:0,offset:t}):this.exponentialSearch({index:o,offset:t})},t.prototype.binarySearch=function(t){for(var e=t.low,o=t.high,i=t.offset,n=0,r=0;e<=o;){if(n=e+Math.floor((o-e)/2),(r=this.getSizeAndPositionForIndex(n).offset)===i)return n;r<i?e=n+1:r>i&&(o=n-1)}return e>0?e-1:0},t.prototype.exponentialSearch=function(t){for(var e=t.index,o=t.offset,i=1;e<this.itemCount&&this.getSizeAndPositionForIndex(e).offset<o;)e+=i,i*=2;return this.binarySearch({high:Math.min(e,this.itemCount-1),low:Math.floor(e/2),offset:o})},t}(),v={overflow:"auto",willChange:"transform",WebkitOverflowScrolling:"touch"},y={position:"relative",overflow:"hidden",width:"100%",minHeight:"100%"},z={position:"absolute",left:0,width:"100%"};return function(n){function r(){var t=null!==n&&n.apply(this,arguments)||this;return t.sizeAndPositionManager=new g({itemCount:t.props.itemCount,itemSizeGetter:function(e){return t.getSize(e)},estimatedItemSize:t.getEstimatedItemSize()}),t.state={offset:t.props.scrollOffset||null!=t.props.scrollToIndex&&t.getOffsetForIndex(t.props.scrollToIndex)||0,scrollChangeReason:c},t.styleCache={},t.handleScroll=function(e){var o=t.props.onScroll,i=t.getNodeOffset();i<0||t.state.offset===i||e.target!==t.rootNode||(t.setState({offset:i,scrollChangeReason:d}),"function"==typeof o&&o(i,e))},t.getRootNodeRef=function(e){t.rootNode=e},t.getInnerNodeRef=function(e){t.innerNode=e},t}return o(r,n),r.prototype.componentDidMount=function(){var t=this.props,e=t.scrollOffset,o=t.scrollToIndex;null!=e?this.scrollTo(e,!0):null!=o&&this.scrollTo(this.getOffsetForIndex(o),!0)},r.prototype.componentWillReceiveProps=function(t){var e=this.props,o=e.estimatedItemSize,i=e.itemCount,n=e.itemSize,r=e.scrollOffset,s=e.scrollToAlignment,a=e.scrollToIndex,l=t.scrollToIndex!==a||t.scrollToAlignment!==s,f=t.itemCount!==i||t.itemSize!==n||t.estimatedItemSize!==o;t.itemCount===i&&t.estimatedItemSize===o||this.sizeAndPositionManager.updateConfig({itemCount:t.itemCount,estimatedItemSize:this.getEstimatedItemSize(t)}),f&&this.recomputeSizes(),t.scrollOffset!==r?this.setState({offset:t.scrollOffset||0,scrollChangeReason:c}):"number"==typeof t.scrollToIndex&&(l||f)&&this.setState({offset:this.getOffsetForIndex(t.scrollToIndex,t.scrollToAlignment,t.itemCount),scrollChangeReason:c})},r.prototype.componentDidUpdate=function(t,e){var o=this.state,i=o.offset,n=o.scrollChangeReason;e.offset!==i&&n===c&&this.scrollTo(i)},r.prototype.getEstimatedItemSize=function(t){return void 0===t&&(t=this.props),t.estimatedItemSize||"number"==typeof t.itemSize&&t.itemSize||50},r.prototype.getNodeOffset=function(){var t=this.props.scrollDirection,e=void 0===t?"vertical":t;return this.rootNode[u[e]]},r.prototype.scrollTo=function(t,e){var o=this;void 0===e&&(e=!1);var i=this.props.scrollDirection,n=void 0===i?"vertical":i,r=this.innerNode.getBoundingClientRect();if(this.rootNode[u[n]]=t,!e&&void 0!==this.props.scrollToTransition&&""===this.innerNode.style.transition){var s=this.innerNode.getBoundingClientRect(),a=r[p[n]]-s[p[n]];this.innerNode.style.transform=m[n]+"("+a+"px)",requestAnimationFrame(function(){o.innerNode.style.transition=o.props.scrollToTransition||"",o.innerNode.style.transitionProperty="transform",o.innerNode.style.transform=""});var l=function(){o.innerNode.style.transition="",o.innerNode.style.transitionProperty="",o.innerNode.removeEventListener("transitionend",l)};this.innerNode.addEventListener("transitionend",l)}},r.prototype.getOffsetForIndex=function(t,e,o){void 0===e&&(e=this.props.scrollToAlignment),void 0===o&&(o=this.props.itemCount);var i=this.props.scrollDirection,n=void 0===i?"vertical":i;return(t<0||t>=o)&&(t=0),this.sizeAndPositionManager.getUpdatedOffsetForIndex({align:e,containerSize:this.props[h[n]],currentOffset:this.state&&this.state.offset||0,targetIndex:t})},r.prototype.getSize=function(t){var e=this.props.itemSize;return"function"==typeof e?e(t):Array.isArray(e)?e[t]:e},r.prototype.getStyle=function(t){var e=this.styleCache[t];if(e)return e;var o=this.props.scrollDirection,i=void 0===o?"vertical":o,n=this.sizeAndPositionManager.getSizeAndPositionForIndex(t),r=n.size,s=n.offset;return this.styleCache[t]=f({},z,(a={},a[h[i]]=r,a[p[i]]=s,a));var a},r.prototype.recomputeSizes=function(t){void 0===t&&(t=0),this.styleCache={},this.sizeAndPositionManager.resetItem(t)},r.prototype.render=function(){var e=this.props,o=(e.estimatedItemSize,e.height),n=e.overscanCount,r=void 0===n?3:n,s=e.renderItem,a=(e.itemCount,e.itemSize,e.onItemsRendered),l=(e.onScroll,e.scrollDirection),d=void 0===l?"vertical":l,c=e.scrollToTransition,u=(e.scrollOffset,e.scrollToIndex,e.scrollToAlignment,e.style),p=e.width,m=i(e,["estimatedItemSize","height","overscanCount","renderItem","itemCount","itemSize","onItemsRendered","onScroll","scrollDirection","scrollToTransition","scrollOffset","scrollToIndex","scrollToAlignment","style","width"]),g=this.state.offset,z=this.sizeAndPositionManager.getVisibleRange({containerSize:this.props[h[d]]||0,offset:g,overscanCount:r}),I=z.start,S=z.stop,x=[];if(void 0!==I&&void 0!==S){for(var C=I;C<=S;C++)x.push(s({index:C,style:this.getStyle(C)}));"function"==typeof a&&a({startIndex:I,stopIndex:S})}return t.createElement("div",f({ref:this.getRootNodeRef},m,{onScroll:this.handleScroll,style:f({},v,u,{height:o,width:p})}),t.createElement("div",{ref:this.getInnerNodeRef,style:f({},y,(O={willChange:void 0!==c?"transform":null},O[h[d]]=this.sizeAndPositionManager.getTotalSize(),O))},x));var O},r.defaultProps={overscanCount:3,scrollDirection:"vertical",width:"100%"},r.propTypes={estimatedItemSize:e.number,height:e.oneOfType([e.number,e.string]).isRequired,itemCount:e.number.isRequired,itemSize:e.oneOfType([e.number,e.array,e.func]).isRequired,onItemsRendered:e.func,overscanCount:e.number,renderItem:e.func.isRequired,scrollOffset:e.number,scrollToIndex:e.number,scrollToAlignment:e.oneOf(["auto","start","center","end"]),scrollToTransition:e.string,scrollDirection:e.oneOf(["horizontal","vertical"]).isRequired,width:e.oneOfType([e.number,e.string]).isRequired},r}(t.PureComponent)});
